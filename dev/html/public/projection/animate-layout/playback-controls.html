<html>
    <head>
        <style>
            body {
                padding: 0;
                margin: 0;
            }

            #box {
                width: 100px;
                height: 100px;
                background-color: #00cc88;
            }

            #box.expanded {
                width: 300px;
                height: 300px;
                position: absolute;
                top: 100px;
                left: 100px;
            }

            [data-layout-correct="false"] {
                background: #dd1144 !important;
                opacity: 0.5;
            }
        </style>
    </head>
    <body>
        <div id="box" data-layout-correct="true"></div>

        <script type="module" src="/src/imports/animate-layout.js"></script>
        <script type="module" src="/src/imports/script-assert.js"></script>
        <script type="module">
            console.log("Test: playback-controls.html")

            const { unstable_animateLayout } = window.AnimateLayout
            const box = document.getElementById("box")

            console.log("unstable_animateLayout:", typeof unstable_animateLayout)

            if (!unstable_animateLayout) {
                showError(box, "unstable_animateLayout is not defined")
                throw new Error("unstable_animateLayout is not defined")
            }

            ;(async () => {
                try {
                    const controls = await unstable_animateLayout(
                        box,
                        () => {
                            console.log("Mutation: adding expanded class")
                            box.classList.add("expanded")
                        },
                        { duration: 1 }
                    )

                    console.log("Controls:", controls)

                    // Test that playback control methods exist and are callable
                    const hasPlay = typeof controls.play === "function"
                    const hasPause = typeof controls.pause === "function"
                    const hasStop = typeof controls.stop === "function"
                    const hasCancel = typeof controls.cancel === "function"
                    const hasComplete = typeof controls.complete === "function"
                    const hasFinished = controls.finished && typeof controls.finished.then === "function"

                    console.log("hasPlay:", hasPlay)
                    console.log("hasPause:", hasPause)
                    console.log("hasStop:", hasStop)
                    console.log("hasCancel:", hasCancel)
                    console.log("hasComplete:", hasComplete)
                    console.log("hasFinished:", hasFinished)

                    if (!hasPlay) showError(box, "Missing play() method")
                    if (!hasPause) showError(box, "Missing pause() method")
                    if (!hasStop) showError(box, "Missing stop() method")
                    if (!hasCancel) showError(box, "Missing cancel() method")
                    if (!hasComplete) showError(box, "Missing complete() method")
                    if (!hasFinished) showError(box, "Missing finished promise")

                    // Test time and speed getters
                    console.log("controls.time:", controls.time)
                    console.log("controls.speed:", controls.speed)
                    console.log("controls.duration:", controls.duration)

                    controls.finished.then(() => {
                        console.log("Animation finished - test passed!")
                    }).catch(err => {
                        console.error("Animation error:", err)
                        showError(box, `Animation error: ${err.message}`)
                    })
                } catch (err) {
                    console.error("Error:", err)
                    showError(box, `Error: ${err.message}`)
                }
            })()
        </script>
    </body>
</html>
